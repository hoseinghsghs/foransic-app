(function(i){var x={tagClass:function(t){return"badge badge-info"},itemValue:function(t){return t&&t.toString()},itemText:function(t){return this.itemValue(t)},itemTitle:function(t){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(t,e){e.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};function v(t,e){this.isInit=!0,this.itemsArray=[],this.$element=i(t),this.$element.hide(),this.isSelect=t.tagName==="SELECT",this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=e&&e.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=i('<div class="bootstrap-tagsinput"></div>'),this.$input=i('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(e),this.isInit=!1}v.prototype={constructor:v,add:function(t,e,a){var n=this;if(!(n.options.maxTags&&n.itemsArray.length>=n.options.maxTags)&&!(t!==!1&&!t)){if(typeof t=="string"&&n.options.trimValue&&(t=i.trim(t)),typeof t=="object"&&!n.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(n.isSelect&&!n.multiple&&n.itemsArray.length>0&&n.remove(n.itemsArray[0]),typeof t=="string"&&this.$element[0].tagName==="INPUT"){var r=n.options.delimiterRegex?n.options.delimiterRegex:n.options.delimiter,l=t.split(r);if(l.length>1){for(var s=0;s<l.length;s++)this.add(l[s],!0);e||n.pushVal();return}}var o=n.options.itemValue(t),u=n.options.itemText(t),p=n.options.tagClass(t),f=n.options.itemTitle(t),c=i.grep(n.itemsArray,function(S){return n.options.itemValue(S)===o})[0];if(c&&!n.options.allowDuplicates){if(n.options.onTagExists){var h=i(".tag",n.$container).filter(function(){return i(this).data("item")===c});n.options.onTagExists(t,h)}return}if(!(n.items().toString().length+t.length+1>n.options.maxInputLength)){var d=i.Event("beforeItemAdd",{item:t,cancel:!1,options:a});if(n.$element.trigger(d),!d.cancel){n.itemsArray.push(t);var g=i('<span class="tag '+m(p)+(f!==null?'" title="'+f:"")+'">'+m(u)+'<span data-role="remove"></span></span>');g.data("item",t),n.findInputWrapper().before(g),g.after(" ");var V=i('option[value="'+encodeURIComponent(o)+'"]',n.$element).length||i('option[value="'+m(o)+'"]',n.$element).length;if(n.isSelect&&!V){var y=i("<option selected>"+m(u)+"</option>");y.data("item",t),y.attr("value",o),n.$element.append(y)}e||n.pushVal(),(n.options.maxTags===n.itemsArray.length||n.items().toString().length===n.options.maxInputLength)&&n.$container.addClass("bootstrap-tagsinput-max"),i(".typeahead, .twitter-typeahead",n.$container).length&&n.$input.typeahead("val",""),this.isInit?n.$element.trigger(i.Event("itemAddedOnInit",{item:t,options:a})):n.$element.trigger(i.Event("itemAdded",{item:t,options:a}))}}}}},remove:function(t,e,a){var n=this;if(n.objectItems&&(typeof t=="object"?t=i.grep(n.itemsArray,function(l){return n.options.itemValue(l)==n.options.itemValue(t)}):t=i.grep(n.itemsArray,function(l){return n.options.itemValue(l)==t}),t=t[t.length-1]),t){var r=i.Event("beforeItemRemove",{item:t,cancel:!1,options:a});if(n.$element.trigger(r),r.cancel)return;i(".tag",n.$container).filter(function(){return i(this).data("item")===t}).remove(),i("option",n.$element).filter(function(){return i(this).data("item")===t}).remove(),i.inArray(t,n.itemsArray)!==-1&&n.itemsArray.splice(i.inArray(t,n.itemsArray),1)}e||n.pushVal(),n.options.maxTags>n.itemsArray.length&&n.$container.removeClass("bootstrap-tagsinput-max"),n.$element.trigger(i.Event("itemRemoved",{item:t,options:a}))},removeAll:function(){var t=this;for(i(".tag",t.$container).remove(),i("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal()},refresh:function(){var t=this;i(".tag",t.$container).each(function(){var e=i(this),a=e.data("item"),n=t.options.itemValue(a),r=t.options.itemText(a),l=t.options.tagClass(a);if(e.attr("class",null),e.addClass("tag "+m(l)),e.contents().filter(function(){return this.nodeType==3})[0].nodeValue=m(r),t.isSelect){var s=i("option",t.$element).filter(function(){return i(this).data("item")===a});s.attr("value",n)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,e=i.map(t.items(),function(a){return t.options.itemValue(a).toString()});t.$element.val(e,!0).trigger("change")},build:function(t){var e=this;if(e.options=i.extend({},x,t),e.objectItems&&(e.options.freeInput=!1),b(e.options,"itemValue"),b(e.options,"itemText"),A(e.options,"tagClass"),e.options.typeahead){var a=e.options.typeahead||{};A(a,"source"),e.$input.typeahead(i.extend({},a,{source:function(s,o){function u(c){for(var h=[],d=0;d<c.length;d++){var g=e.options.itemText(c[d]);p[g]=c[d],h.push(g)}o(h)}this.map={};var p=this.map,f=a.source(s);i.isFunction(f.success)?f.success(u):i.isFunction(f.then)?f.then(u):i.when(f).then(u)},updater:function(s){return e.add(this.map[s]),this.map[s]},matcher:function(s){return s.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(s){return s.sort()},highlighter:function(s){var o=new RegExp("("+this.query+")","gi");return s.replace(o,"<strong>$1</strong>")}}))}if(e.options.typeaheadjs){var n=null,r={},l=e.options.typeaheadjs;i.isArray(l)?(n=l[0],r=l[1]):r=l,e.$input.typeahead(n,r).on("typeahead:selected",i.proxy(function(s,o){r.valueKey?e.add(o[r.valueKey]):e.add(o),e.$input.typeahead("val","")},e))}e.$container.on("click",i.proxy(function(s){e.$element.attr("disabled")||e.$input.removeAttr("disabled"),e.$input.focus()},e)),e.options.addOnBlur&&e.options.freeInput&&e.$input.on("focusout",i.proxy(function(s){i(".typeahead, .twitter-typeahead",e.$container).length===0&&(e.add(e.$input.val()),e.$input.val(""))},e)),e.$container.on("keydown","input",i.proxy(function(s){var o=i(s.target),u=e.findInputWrapper();if(e.$element.attr("disabled")){e.$input.attr("disabled","disabled");return}switch(s.which){case 8:if(I(o[0])===0){var p=u.prev();p.length&&e.remove(p.data("item"))}break;case 46:if(I(o[0])===0){var f=u.next();f.length&&e.remove(f.data("item"))}break;case 37:var c=u.prev();o.val().length===0&&c[0]&&(c.before(u),o.focus());break;case 39:var h=u.next();o.val().length===0&&h[0]&&(h.after(u),o.focus());break}o.val().length,o.attr("size",Math.max(this.inputSize,o.val().length))},e)),e.$container.on("keypress","input",i.proxy(function(s){var o=i(s.target);if(e.$element.attr("disabled")){e.$input.attr("disabled","disabled");return}var u=o.val(),p=e.options.maxChars&&u.length>=e.options.maxChars;e.options.freeInput&&(w(s,e.options.confirmKeys)||p)&&(u.length!==0&&(e.add(p?u.substr(0,e.options.maxChars):u),o.val("")),e.options.cancelConfirmKeysOnEmpty===!1&&s.preventDefault()),o.val().length,o.attr("size",Math.max(this.inputSize,o.val().length))},e)),e.$container.on("click","[data-role=remove]",i.proxy(function(s){e.$element.attr("disabled")||e.remove(i(s.target).closest(".tag").data("item"))},e)),e.options.itemValue===x.itemValue&&(e.$element[0].tagName==="INPUT"?e.add(e.$element.val()):i("option",e.$element).each(function(){e.add(i(this).attr("value"),!0)}))},destroy:function(){var t=this;t.$container.off("keypress","input"),t.$container.off("click","[role=remove]"),t.$container.remove(),t.$element.removeData("tagsinput"),t.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],e=this.$container[0];t&&t.parentNode!==e;)t=t.parentNode;return i(t)}},i.fn.tagsinput=function(t,e,a){var n=[];return this.each(function(){var r=i(this).data("tagsinput");if(!r)r=new v(this,t),i(this).data("tagsinput",r),n.push(r),this.tagName==="SELECT"&&i("option",i(this)).attr("selected","selected"),i(this).val(i(this).val());else if(!t&&!e)n.push(r);else if(r[t]!==void 0){if(r[t].length===3&&a!==void 0)var l=r[t](e,null,a);else var l=r[t](e);l!==void 0&&n.push(l)}}),typeof t=="string"?n.length>1?n:n[0]:n},i.fn.tagsinput.Constructor=v;function b(t,e){if(typeof t[e]!="function"){var a=t[e];t[e]=function(n){return n[a]}}}function A(t,e){if(typeof t[e]!="function"){var a=t[e];t[e]=function(){return a}}}var T=i("<div />");function m(t){return t?T.text(t).html():""}function I(t){var e=0;if(document.selection){t.focus();var a=document.selection.createRange();a.moveStart("character",-t.value.length),e=a.text.length}else(t.selectionStart||t.selectionStart=="0")&&(e=t.selectionStart);return e}function w(t,e){var a=!1;return i.each(e,function(n,r){if(typeof r=="number"&&t.which===r)return a=!0,!1;if(t.which===r.which){var l=!r.hasOwnProperty("altKey")||t.altKey===r.altKey,s=!r.hasOwnProperty("shiftKey")||t.shiftKey===r.shiftKey,o=!r.hasOwnProperty("ctrlKey")||t.ctrlKey===r.ctrlKey;if(l&&s&&o)return a=!0,!1}}),a}i(function(){i("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);
